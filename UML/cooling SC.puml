@startuml
' Activity diagram approximating the provided image

start
:Read flags and sensors;

if ("Cooling mode?") then (External)
    if ("Has PWM signal via Q-link?") then (Y)
        :Wait 5 seconds;
        if ("Has signal after 5 sec?") then (Y)
            :Apply external PWM;
            note right
                PWM from software
            end note
            -> SwitchInternal
        else (N)
            -> SwitchInternal
        endif
    else (N)
        -> SwitchInternal
    endif

else (Internal)
    if ("Has curves stored on device?") then (Y)
        if ("Has valid temperature\nsensor data?") then (Y)
            :Apply temperature to the\ncurves to generate PWM%;
            note right
                PWM from stored curves
            end note
        else (N)
            -> SwitchInternal
        endif
    else (N)
        if ("'PWM source' = External?") then (Y)
            if ("Has valid PWM signal?") then (Y)
                :Apply incoming PWM to\nW1 pump and fans;
                note bottom
                    PWM from MB
                end note
            else (N)
                :Apply 50% PWM;
                note bottom
                    PWM 50%
                end note
            endif
        else (N)
            :Apply 50% PWM;
            note bottom
                PWM 50%
            end note
        endif
    endif
endif

:Switch to internal;
stop

@enduml